<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FBX to Text Converter</title>
    <style>
        body { font-family: Arial, sans-serif; }
        #output { white-space: pre-wrap; word-wrap: break-word; border: 1px solid #ccc; padding: 10px; max-height: 500px; overflow: auto; }
    </style>
</head>
<body>
    <h1>FBX Model to Text Converter</h1>
    <p>Upload an FBX file to extract its data as JSON text.</p>
    <input type="file" id="fileInput" accept=".fbx">
    <div id="output"></div>

    <script type="module">
        import * as THREE from 'https://unpkg.com/three@latest/build/three.module.js';
        import { FBXLoader } from 'https://unpkg.com/three@latest/examples/jsm/loaders/FBXLoader.js';

        const input = document.getElementById('fileInput');
        const output = document.getElementById('output');

        input.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                output.textContent = 'Loading...';
                const loader = new FBXLoader();
                const url = URL.createObjectURL(file);
                loader.load(url, (object) => {
                    const json = object.toJSON();
                    output.textContent = JSON.stringify(json, null, 2);
                    URL.revokeObjectURL(url);
                }, undefined, (error) => {
                    output.textContent = 'Error loading FBX: ' + error.message;
                });
            }
        });
    </script>

    <script>
        // Inline manifest for PWA
        const manifest = {
            "short_name": "FBXConverter",
            "name": "FBX to Text Converter",
            "start_url": ".",
            "display": "standalone",
            "theme_color": "#ffffff",
            "background_color": "#ffffff"
        };
        const manifestBlob = new Blob([JSON.stringify(manifest, null, 2)], { type: 'application/json' });
        const manifestURL = URL.createObjectURL(manifestBlob);
        const link = document.createElement('link');
        link.rel = 'manifest';
        link.href = manifestURL;
        document.head.appendChild(link);

        // Inline service worker for PWA (basic fetch-through)
        if ('serviceWorker' in navigator) {
            const swCode = `
                self.addEventListener('fetch', (event) => {
                    event.respondWith(fetch(event.request));
                });
            `;
            const swBlob = new Blob([swCode], { type: 'application/javascript' });
            const swURL = URL.createObjectURL(swBlob);
            navigator.serviceWorker.register(swURL)
                .then(registration => console.log('Service Worker registered'))
                .catch(error => console.log('Service Worker registration failed:', error));
        }
    </script>
</body>
</html>